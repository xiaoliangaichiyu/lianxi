import  requests
from pprint import pprint
import execjs
headers = {
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0',
    'referer': 'https://music.163.com/',
    'cookie': 'timing_user_id=time_o7TjMxTxLJ; OUTFOX_SEARCH_USER_ID_NCOO=665471664.7484661; mp_MA-BFF5-63705950A31C_hubble=%7B%22sessionReferrer%22%3A%20%22https%3A%2F%2Fke.study.163.com%2Fcourse%2Fdetail%2F100156952%22%2C%22updatedTime%22%3A%201754376398556%2C%22sessionStartTime%22%3A%201754376397912%2C%22sendNumClass%22%3A%20%7B%22allNum%22%3A%204%2C%22errSendNum%22%3A%204%7D%2C%22deviceUdid%22%3A%20%229da354e35c586eb03c832434ae720045eb481b93%22%2C%22persistedTime%22%3A%201754376397909%2C%22LASTEVENT%22%3A%20%7B%22eventId%22%3A%20%22a3e1dcebfae4610cbe2c2bbb08b2bb70bd38ba1c%22%2C%22time%22%3A%201754376398556%7D%2C%22sessionUuid%22%3A%20%221f7b5436a0ec8eaf54f726e4b492b00fc0558c82%22%7D; _iuqxldmzr_=32; NMTID=00OlCRcBPgWHT9RsUL2k6OZuMmgzJcAAAGYiEvA1w; WEVNSM=1.0.0; WNMCID=cfjsqf.1754633323524.01.0; __snaker__id=SXqzd1Q8b0Qrg85D; ntes_utid=tid._.SQmn0w4ZZTlAFhQVFBLX0NSBJdq1ovFH._.0; sDeviceId=YD-0z%2BTcOCscS9EUkRQUVKXwdTANI6g9%2FBW; WM_TID=0fGbcRYUJQdEBVVAQBLGlIXEccuknkVs; ntes_kaola_ad=1; WM_NI=upFvIqVY8uApEKesGyT2UWD0ZoltJNUJoypcT%2FognzypZUQw65xc2sfs0dIjY2ti7g6ZDAb1pLHMum6Mwi%2BL1fXwKhLj63NIcnzXcwdpc7lVoM2ZoMdvXTl5V00pXfktMlo%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eea4c165abbf9fa7f06fa9b48fa7d84f828a9badc23c8b98a682b5708fec878ef82af0fea7c3b92ab7b08a97cc7b9687f896c47c8795ab94c67398ee9bb8c73c9ab1a495c9469796a19af36998f1a188ed72bbb096b6d47df6ebb884b179a6ad0085cc629beebc8ab66df6868ca2e13bb49488aef867f693b98aaa48f3ba9898ca6490b6fad4cd43a1b2b6b9e27da8b0add8ef5ead93febbee47a8aa98b5ef3f96f00091db6ea9ac838dee37e2a3; JSESSIONID-WYYY=w5x%2Bn2P7KrwC8IXd%5C7cB0Yf4U3yi0%2FUnu6X2YDM%5CFC1b%2FrenlKCVFcmf%5CNJ2SyT8rcD%2FGZW7%2BIQybNXt8Woz%2BGm%2FbjFc%2BPXc9UbPp3ayA92Rz81HmrQItnfZbW8gI%2FyjYMWUTBMSlkNYbTskb%2F0I6iNCyhwN5UF4ep%2FFs2eavWlsXiwX%3A1754723982870; gdxidpyhxdE=%5C13hMPgyKe2hCHY3aja%2BklQlT6sBm2z0h88nXUgQsQP%2BMKOQiO5QwmHHfUgN9emZi%2BcUHD5Uwckm%5C%5C%2BqJpJ8f3Cj8cRRV7oxQKvCyEz4%2BOZbotCLV%2B%5CnHtgm6b97CB%5CjRhS7J4ufQoyrlIsM0s4rn9hiJEpqsYaEeoWxXv8pO6GLfgxf%3A1754724350497; __csrf=62f306819d55be1378f6d9c3de2c1091; MUSIC_U=00DC0CB3C4FA9FDEEF8074616365209E3013A10AB78F88ACEC2D97AF9E5353D533873F248D6E46BBEDC10D066013099ED447B1E1C63BE77E444495FCBA60092D410529D4BE988FC14DE7C95910F89196FB580E32B7FF2443B5ABAE5F2B9772940D8850D483B3DFDB00AE94BF64B0D2DB9CF1604744EE9FE0DE8E166AB1AFFC4F13B01BFD492F984BDB262E8569B85A032D1C00AFC7B458307086C9629C0E6BD580084478AB1B92FFAE8D6996C710FF70781E5E5B994D8A648A27DFD8A0E0456A069C4A2E23DC794AADC5724080ACD13E197EA8BF5DA5FC2D60BBD75A375BE9E9C75A64BBD031C3CF8E476BFBDD1E24EF6455475E506DFB41D9C9D4D190BDA23E60D83DABF9BAF81602E7993286A63FA2B7A22E7D49625BC6703D378F60A3BED33940F4318817132D19BDE605B819A305B699E371A37C7927D2142C93636443971C4D582368453DDD091A997DD6C4888EC3E897EF71729ADA30F7A502781B4E6A7B31B051703E2BDEE54ABBAB3BEE453CF9C99CC61CF38A98C1C904064FC6F5C9C2A95D0C15811047F31D9AC8AC3FC6437CB7CC5D4F4614BCE4DA82B6FD67B55DB5; playerid=85235107'}
data2 = {
'params':' 4ldIMLk5jBkWUnzr3fjGiCvU8s3ksKzVwZyKNQWCM5udcHLRCvwR7xcSLMulcwxhKlOiSnN7dA+s2LjCyJXboODjH8EW/hq8YUdzNg//1MrF6wYJIkWrtNgKbpt3rXgiKNcPiSdnRb+SGK8LFjbF47l51jRARZ+0rOiLa+TC0osGsp2XuAksQ6ivvLnKIJx26w7v2Fwl1mMwikii+zdWTeVkcjRntFRIZ8N8C0VjL6NvW2GseAAL/N1wlEV3kpYG33UmpE2jZo6ifCdqiUnOkv7v3AeAmrx4gTwgg9ILHi2Kh1FyrIm9bs8uRFBYY0tp',
'encSecKey':'18d2e0e95e47fd776b0f401021036c989dc8c840c2e74cc4987a45954605c43af08ed33f9b49c46c2602ea8343e94ef50dd0893c305bac233d54a4264b623bcaa2f4e33ed2c05298771231c1a933db5ee7b5c4acebe9822ff7e0c4ff2e7190fe3ab6906a883a20d1c10ae8166485e09c2c1c5b62e44cee9762f8d50762fe4e48'
}


a_url = 'https://music.163.com/weapi/cloudsearch/get/web?csrf_token=db9f233dd05de941d8c19d94eaf9f14f'
res = requests.post(url=a_url, data=data2,headers = headers).json()

text  = res['result']['songs']
for i in text:
    id = i['id']
    title= i['name']
    print(id,title)

    js_code = execjs.compile(open('aaa.js',encoding='utf-8').read())
    d = {"id":f"{id}","lv":-1,"tv":-1,"csrf_token":"db9f233dd05de941d8c19d94eaf9f14f"}
    result = js_code.call('getsign',d)
    print(result)

    url = 'https://music.163.com/weapi/song/enhance/player/url/v1?csrf_token=62f306819d55be1378f6d9c3de2c1091'
    data1 = {
        'params': result['encText'],
        'encSecKey': result['encSecKey']
    }
    respons = requests.post(url=url, data=data1, headers=headers).json()
    print(respons)

    m_url = respons['data'][0]['url']
    resp = requests.get(url=m_url, headers=headers).content
    with open('./yy/aaa.mp3', 'ab') as f:
        f.write(resp)




